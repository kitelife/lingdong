//
// Created by xiayf on 2025/6/9.
//

#include <gtest/gtest.h>


#include "utils/simd.hpp"

TEST(SimdTest, float_sum) {
  std::vector<float> v = {1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0};
  float result = ling::utils::simd::sum(v);
  std::cout << "sum=" << result << std::endl;
  EXPECT_FLOAT_EQ(result, 28.0);
}

TEST(SimdTest, int64_x_sum) {
  std::vector<int64_t> v = {1, 2, 3, 4, 5, 6, 7};
  int64_t result = ling::utils::simd::x_sum(v);
  std::cout << "sum=" << result << std::endl;
  EXPECT_FLOAT_EQ(result, 28);
}

TEST(SimdTest, float_distance_ip) {
  std::vector<float> va = {1.0, 2.0, 3.0, 4.0, 5.0, 6.0};
  std::vector<float> vb = {1.0, 2.0, 3.0, 4.0, 5.0, 6.0};
  float result = ling::utils::simd::distance_ip(va, vb);
  EXPECT_FLOAT_EQ(result, 91.0);
}

TEST(SimdTest, x_float_distance_ip) {
  std::vector<float> va = {-0.046592608,0.13559009,0.05813315,-1.2032771E-5,1.1667326E-5,-0.011281547,0.06775157,-0.10660537,-0.010967214,-0.025725372,0.31316388,-0.011810119,0.11322718,-0.022999432,-0.0067719417,0.31034914,-0.035350878,-0.014437395,0.007568602,-0.13819076,0.025398122,-0.057802312,-0.027214367,8.085581E-6,0.062188208,0.11090969,-2.8603364E-7,-0.039084043,-0.010655461,-0.07389918,0.070385255,0.09228479,0.040704403,-6.2415115E-6,-0.07486037,0.077280395,-0.015963942,-0.025305782,-0.1122041,-9.232807E-4,-0.031096263,0.01920236,0.0028060966,-0.011366915,0.027443869,-0.02952648,-0.022360219,-5.982155E-6,-0.023955481,-0.0069269617,-0.024277769,-0.004870543,0.07174117,0.2863095,-0.21407616,-0.026712287,0.023442026,-0.18506956,-0.06510372,-0.0035610278,0.19588318,-0.0874435,0.09725793,-0.25051257,-0.013528725,1.0460857E-6,0.02510975,0.20585702,0.0015599922,-0.024300087,-0.096254356,-0.0664181,0.020739835,0.11199655,-0.020651428,-0.16992083,4.6884797E-6,0.08594259,-0.012048918,0.080287285,-0.058972646,0.08572471,-0.07666349,-0.01795208,0.0048969868,-0.045755994,-0.074629426,-0.07737719,0.14725755,-0.021804476,-0.0069851265,-0.006221883,-8.174377E-6,9.788893E-6,-0.012631311,-0.030668125,-9.932349E-6,-0.02159107,0.10483799,3.993949E-6,0.043460775,0.042925265,0.016364377,-0.053373016,-0.031870175,-0.025988804,-0.028621342,-0.037861336,0.0064328937,-0.040370803,-0.0305484,-0.036109142,-0.043114644,0.05436812,0.1335014,-0.012511797,-0.030283429,5.9738186E-6,0.24701829,0.03059611,-0.015029663,-0.009506911,-0.07436945,5.5521073E-6,-0.0455445,0.22014591,-5.2609103E-6,-0.17531122};
  std::vector<float> vb = {-0.046592608,0.13559009,0.05813315,-1.2032771E-5,1.1667326E-5,-0.011281547,0.06775157,-0.10660537,-0.010967214,-0.025725372,0.31316388,-0.011810119,0.11322718,-0.022999432,-0.0067719417,0.31034914,-0.035350878,-0.014437395,0.007568602,-0.13819076,0.025398122,-0.057802312,-0.027214367,8.085581E-6,0.062188208,0.11090969,-2.8603364E-7,-0.039084043,-0.010655461,-0.07389918,0.070385255,0.09228479,0.040704403,-6.2415115E-6,-0.07486037,0.077280395,-0.015963942,-0.025305782,-0.1122041,-9.232807E-4,-0.031096263,0.01920236,0.0028060966,-0.011366915,0.027443869,-0.02952648,-0.022360219,-5.982155E-6,-0.023955481,-0.0069269617,-0.024277769,-0.004870543,0.07174117,0.2863095,-0.21407616,-0.026712287,0.023442026,-0.18506956,-0.06510372,-0.0035610278,0.19588318,-0.0874435,0.09725793,-0.25051257,-0.013528725,1.0460857E-6,0.02510975,0.20585702,0.0015599922,-0.024300087,-0.096254356,-0.0664181,0.020739835,0.11199655,-0.020651428,-0.16992083,4.6884797E-6,0.08594259,-0.012048918,0.080287285,-0.058972646,0.08572471,-0.07666349,-0.01795208,0.0048969868,-0.045755994,-0.074629426,-0.07737719,0.14725755,-0.021804476,-0.0069851265,-0.006221883,-8.174377E-6,9.788893E-6,-0.012631311,-0.030668125,-9.932349E-6,-0.02159107,0.10483799,3.993949E-6,0.043460775,0.042925265,0.016364377,-0.053373016,-0.031870175,-0.025988804,-0.028621342,-0.037861336,0.0064328937,-0.040370803,-0.0305484,-0.036109142,-0.043114644,0.05436812,0.1335014,-0.012511797,-0.030283429,5.9738186E-6,0.24701829,0.03059611,-0.015029663,-0.009506911,-0.07436945,5.5521073E-6,-0.0455445,0.22014591,-5.2609103E-6,-0.17531122};
  float result = ling::utils::simd::x_distance_ip(va, vb);
  EXPECT_FLOAT_EQ(result, 1.0);
}
